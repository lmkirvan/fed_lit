---
title: "judges"
format: html
editor: visual
---

Trying to get a data-set of which judges are in each district court on each day.

Each judge has his own page with a structured paragraph. Detailing service.

we need:

-   appointments (sometimes more than one)

    -   date of start, date of senior status, date of termination

```{=html}
<!-- -->
```
-   president (can vary by appointment)

-   court (can vary by appointment)

```{r}

# base url with pages for each letter:
url <- "https://www.fjc.gov/history/judges/search/glossary-search/"

letters <- letters
urls <- paste0(url, letters)

get_judges <- function(letter_url){
  
  rvest::read_html(letter_url) |> 
    rvest::html_element(
      css = "body > div.l-page > div > div > div > div.view-content") |> 
    rvest::html_elements("a") |> 
    rvest::html_attrs() -> judge_stems
  
  paste0("https://www.fjc.gov", judge_stems)
}

judges <- purrr::map(urls, get_judges) |>  purrr::list_c()

get_text <- function(url){ 
  url |> 
    rvest::read_html() |> 
    rvest::html_element(css = "body > div.l-page > div > div > div > div") |> 
    rvest::html_text2()
  }

#this takes a bit. 
texts <- purrr:::map(judges, get_text)
#discard everything after education!
texts <- 

#this was just so I could iterate regex while testing. but having a keyword and
#'rest' function might be good here. could paste together different ends. 
ff <- function(key_words, rest = ".*?[0-9]{4}[:punct:]" ){
  
  patterns <-glue::glue(
    "({{key_words}}{{rest}})"
    , key_words = key_words
    , group_name = group_name
    , rest = rest
    , .open = "{{"
    , .close = "}}"
    )
  
  purrr::partial(stringr::str_extract_all, pattern = patterns)
  
  }

#this gets the dates for various court changes 
get_dates <- ff(c("[nN]ominated"
                  , "[cC]ommission"
                  , "[sS]tatus"
                  , "[:space:][Aa]ssigned"
                  , "[Rr]eassigned"
                  , "[tT]erminated"))
dates <- purrr::map(texts, get_dates)

## court names 
get_courts <- ff(c("Justice", "Judge"), rest = ".*?\n") 
courts <- purrr::map(texts, get_courts)

#the total number of terminations should match the total number of commissions and assignments 

#the total number of courts should match the commisions plust assigments for judges that are terminated

commissions <- purrr::map(dates, 2) |> lengths()
assign <- (purrr::map(dates, 4) |> lengths()) + (purrr::map(dates, 5) |> lengths()) 

total <- commissions + assign

terminations <- purrr::map(dates, 6) |> lengths()

total
terminations
dates[[11]]
judges[[11]]

total_courts <- (map(courts, 1) |> lengths()) + (map(courts,2) |> lengths() ) 

terminations <- ifelse(terminations == 0, 1, terminations)

sum(total != total_courts)

judges[terminations != total] 

courts[[283]]

#need to fix the manuscript collections and bibliography
```
