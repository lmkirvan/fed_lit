---
title: "judges"
format: html
editor: visual
---

Trying to get a data-set of which judges are in each district court on each day.

Each judge has his own page with a structured paragraph. Detailing service.

we need:

-   appointments (sometimes more than one)

    -   date of start, date of senior status, date of termination

```{=html}
<!-- -->
```
-   president (can vary by appointment)

-   court (can vary by appointment)

```{r}

# base url with pages for each letter:
url <- "https://www.fjc.gov/history/judges/search/glossary-search/"

letters <- letters
urls <- paste0(url, letters)

get_judges <- function(letter_url){
  
  rvest::read_html(letter_url) |> 
    rvest::html_element(
      css = "body > div.l-page > div > div > div > div.view-content") |> 
    rvest::html_elements("a") |> 
    rvest::html_attrs() -> judge_stems
  
  paste0("https://www.fjc.gov", judge_stems)
}

judges <- purrr::map(urls, get_judges) |>  purrr::list_c()

get_text <- function(url){ 
  url |> 
    rvest::read_html() |> 
    rvest::html_element(css = "body > div.l-page > div > div > div > div") |> 
    rvest::html_text2()
  }

start_of_match <- function(string, pattern){
  stringr::str_locate(string, pattern)[ , 1]
}

# function to make 
cut_after <- function(string, pattern){
  location <- start_of_match(string, pattern ) 
  location[is.na(location)] <- nchar(string)[is.na(location)]
  str_sub( string, start = 0, end = location)
}

#this takes a bit. may need to do it safely
texts <- purrr:::map_chr(judges, get_text)
#save(texts, file = "texts.Rdata")
#discard everything after education!
stop <- str_locate(texts, "Education")[ ,1] 
oath <- str_locate(texts, "Supreme Court Oath:")[, 1]
stop <- ifelse(is.na(oath), stop, oath)

texts <- as.character(texts)

texts |> 
  cut_after("Education") |> 
  cut_after("Supreme Court Oath:") |> 
  cut_after("Other Federal Judicial Service:")-> short_texts

#this was just so I could iterate regex while testing. but having a keyword and
#'rest' function might be good here. could paste together different ends. 
ff <- function(key_words, rest = ".*?[0-9]{4}[:punct:]" ){
  
  patterns <-glue::glue(
    "({{key_words}}{{rest}})"
    , key_words = key_words
    , group_name = group_name
    , rest = rest
    , .open = "{{"
    , .close = "}}"
    )
  
  purrr::partial(stringr::str_extract_all, pattern = patterns)
  
  }

#this gets the dates for various court changes 
get_dates <- ff(c("[nN]ominated"
                  , "[cC]ommission"
                  , "[sS]tatus"
                  , "[:space:][Aa]ssigned"
                  , "[Rr]eassigned"
                  , "[tT]erminated")
                )

dates <- purrr::map(short_texts, get_dates)

## court names 
get_courts <- ff(c("Justice", "Judge"), rest = ".*?\n") 
courts <- purrr::map(short_texts, get_courts)

#the total number of terminations should match the total number of commissions and assignments 
#the total number of courts should match the commisions plust assigments for judges that are terminated

commissions <- purrr::map(dates, 2) |> lengths()
assign <- (purrr::map(dates, 4) |> lengths()) + (purrr::map(dates, 5) |> lengths()) 

total <- commissions + assign
terminations <- purrr::map(dates, 6) |> lengths()

terminations <- ifelse(terminations == 0, 1, terminations)
terminations
total

total_courts <- (map(courts, 1) |> lengths()) + (map(courts,2) |> lengths() ) 
sum(total != total_courts)

which(total_courts != total)
```

```{]}


#need to fix the manuscript collections and bibliography

```
